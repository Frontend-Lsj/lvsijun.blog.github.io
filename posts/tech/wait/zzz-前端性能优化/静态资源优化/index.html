<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>静态资源优化 | Bablvsj's Blog</title><meta name=keywords content="前端性能优化"><meta name=description content="图片格式和应用场景 JPEG 格式 JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。 常用文件扩展名为.jp"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96/><link crossorigin=anonymous href=/assets/css/stylesheet.8305cf06a98284e3b1c87a6046782155feb91526fdd3540ed23cccb363ecfcf7.css integrity="sha256-gwXPBqmChOOxyHpgRnghVf65FSb901QO0jzMs2Ps/Pc=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="静态资源优化"><meta property="og:description" content="图片格式和应用场景 JPEG 格式 JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。 常用文件扩展名为.jp"><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-01T17:11:35+08:00"><meta property="article:modified_time" content="2020-03-01T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="静态资源优化"><meta name=twitter:description content="图片格式和应用场景 JPEG 格式 JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。 常用文件扩展名为.jp"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"文章","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"静态资源优化","item":"https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"静态资源优化","name":"静态资源优化","description":"图片格式和应用场景 JPEG 格式 JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。 常用文件扩展名为.jp","keywords":["前端性能优化"],"articleBody":"图片格式和应用场景 JPEG 格式 JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。\n常用文件扩展名为.jpg，也有 .jpeg和.jpe。JPEG 在互联网上常被应用于存储和传输照片。\n适合：颜色丰富的照片、彩色图大焦点图、通栏 banner 图；结构不规则的图形。\n不适合：线条图形和文字、图标图形，因为它的压缩算法不太这些类型的图形；并且不支持透明度。\nPNG 格式 PNG（Portable Network Graphics）是一种无损压缩的位图图形格式，支持索引、灰度、RGB 三种颜色方案以及 Alpha 通道等特性。\nPNG 最初是作为替代 GIF 来设计的，能够显示 256 色，文件比 JPEG 或者 GIF 大，但是 PNG 非常好的保留了图像质量。支持 Alpha 通道的半透明和透明特性。最高支持 24 位彩色图像（PNG-24）和 8 位灰度图像（PNG-8）。\n适合：纯色、透明、线条绘图，图标；边缘清晰、有大块相同颜色区域；需要带半透明的图片。\n适合：由于是无损存储，所以不太适合体积太大的彩色图像\n比如说，如果你需要带透明背景的图片，此时就可以用 png 格式的图。\nGIF 格式 GIF（Graphics Interchange Format）是一种位图图形格式，以 8 位色（即 256 种颜色）重现真彩色的图像，采用 LZW 压缩算法进行编码。\n支持 256 色；仅支持完全透明和完全不透明；如果需要带动画效果的图片，GIF 是比较通用的选择。\n适合：动画，图标。\n不适合：每个像素只有 8 比特，不适合存储彩色图片。\nWebp 格式 Webp 是一种现代图像格式，可为图像提供无损压缩和有损压缩，这使得它非常灵活。由 Google 在购买 On2 Technologies 后发展出来，以 BSD 授权条款发布。\nWebp的优秀算法能同时保证图像质量和较小体积；可以插入多帧，实现动画效果；可以设置透明度；采用 8 位压缩算法。\n无损的 Webp 比 PNG 小 26%，有损的 Webp 比 JPEG 小 25-34％，比 GIF 有更好的动画。\n适合：适用于图形和半透明图像。 总结 banner图、大图，可以用 jpg、webp格式。\n图标、带透明背景的图，可以用 png 格式。\n带动画效果的图，可以用 gif 格式。\n图片优化的常见方法 1、用工具压缩图片 压缩 PNG 图片：\n工具：node-pngquant-native\n介绍：跨平台、压缩比特别高，压缩png24非常好。\n安装方法：\n1 npm install node-pngquant-native 压缩 JPEG 图片：\n工具：jpegtran\n官网：https://www.npmjs.com/package/jpegtran\n介绍：跨平台，但压缩的比率只有80-90%。\n安装方法：\n1 npm install –g jpegtran 使用方法：\n1 jpegtran -copy none -optimize -outfile output_file.jpg input_file.jpg 压缩 GIF 图：\n工具：Gifsicle\n官网（含安装方法）：https://www.lcdf.org/gifsicle/\n介绍：Gifsicle 通过改变每帧比例，减小 gif文件大小，同时可以使用透明来达到更小的文件大小，是目前公认的最好的解决方案。\n使用方法：\n1 2 3 4 5 # 压缩命令。注意，这里是将压缩级别设置为3。如果将压缩级别设置为1或者2，则基本不压缩。 gifsicle --optimize=3 -o out_file.gif in_file.gif # 裁掉透明部分 gifsicle --optimize=3 --crop-transparency -o out_file.gif in_file.gif 2、将图片尺寸跟随网络环境进行变化 具体方案：不同网络环境（Wifi/4G/3G）下，加载不同尺寸和像素的图片，通过在图片 URL 中添加参数来改变。\n图片 url 举例1：（图片的原始url链接）\n1 https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg 图片 url 举例2：（通过图片的url参数，将这张图的尺寸设置为200px）\n1 https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg 3、响应式图片 方法1：通过 JavaScript 绑定事件，检测窗口大小，以此设置图片大小。\n方法2：CSS媒体查询。\n代码举例：（在 640px的窗口大小里，设置图片的尺寸为640px）\n1 2 3 4 5 @media screen and (max-width:640px) { my_image{ width:640px; } } 方法3：img标签的 srcset 属性。这个是 H5的新特性。\n代码举例：\n1 2 \u003cimg srcset=\"img-320w.jpg, img-640w.jpg 2x, img-960w.jpg 3x\" src=“img-960w.jpg” alt=“img”\u003e （x 描述符：表示图像的设备像素） 4、逐步加载图像：lazyload、LQIP、LQIP 方法1、使用统一占位符。俗称图片的懒加载（lazyload）。\n方法2、使用 LQIP 的图片加载方式。也就是说，在大图没有完全加载出来的情况下，先这张图对应的的低质量图片进行占位。\nLQIP（Low Quality Image Placeholders）：低质量图像占位符。这种技术背后的想法是，在网络环境较差的情况下，你可以尽快向用户展示完全可用的网页，为他们提供更好的体验。即使在更好的网络连接上，这仍然为用户提供了更快的可用页面，并且改善了体验。\n安装 LQIP 工具：npm install lqip\nGitHub源码：https://github.com/zouhir/lqip-loader\n代码举例：（将目标图片转换为 LQIP 形式的图）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 const lqip = require('lqip'); //文件路径 const file = './in.png'; //将输入的图片转为base64 lqip.base64(file).then(res =\u003e { // 色值 console.log(res); }); lqip.palette(file).then(res =\u003e { //这里输出的是base64的图片地址 console.log(res); }); 另外，我们还可以使用 SQIP 的图片加载方式。\nSQIP（SVG Quality Image Placeholders）： SVG 格式的图像占位符。\n安装 SQIP 工具：npm install sqip\nGitHub 源码：https://github.com/axe312ger/sqip\n代码举例：（将目标图片转换为 SQIP 形式的图）\n1 2 3 4 5 6 7 8 const sqip = require('sqip'); const result = sqip({ filename: './input_file.png', numberOfPrimitives: 10 //可根据不同应用场景设置大小 }); console.log(result.final_svg); 5、雪碧图（Image spriting） 雪碧图是比较常见的图片优化方式，也就是把多张小图合并成一张大图。这样的话，就只需做一次网络请求，减少图片的 http 请求次数。\n读者们可以自行查阅。\n6、有些场景下，并不需要图片文件 有些场景下，并不需要图片，我们可以用其他的方式来代替图片。\n举例：\nWeb Font 代替图片\n使用 Data URI 代替图片。base64就是属于 Data URI的方式。\n7、在服务器端进行图片自动优化 图片服务器自动化优化是可以在图片 URL 链接上增加不同特殊参数，服务器自动化生成。通过这些参数，可以设置图片的不同格式、大小、质量。\n常见处理方式：\n图片裁剪：按长边、短边、填充、拉伸等缩放。\n图片格式转换：支持 JPG，GIF，PNG，WebP 等，支持不同的图片压缩率。\n图片处理：添加图片水印、高斯模糊、重心处理、裁剪边框等。\nAI 能力：鉴黄、涉政、智能抠图、智能排版、智能配色、智能合成等 AI 功能。\n图片举例：\n比如JD公司的图片链接，就会在服务器端做优化处理。通过修改图片链接中的参数，就能自动达到相应的优化效果。\n原始图片链接：\n1 https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg 将图片压缩为 200*150：\n1 https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg 将图片转换为 webp 格式：\n1 https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.webp 将图片质量压缩至10%：\n1 https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg.q10 HTML优化 1、精简 HTML 代码 减少 HTML 的嵌套。\n减少 DOM 节点数。\n减少无语义代码（比如: 消除浮动，其实可以用css来处理）。\n删除 http 或者 https：如果URL的协议头和当前页面的协议头一致的，或者此 URL 在多个协议头都是可用的，则可以考虑删除协议头。\n删除多余的空格、换行符、缩进和不必要的注释。\n省略冗余标签和属性。\n使用相对路径的 URL。\n2、文件放在合适位置 CSS 样式文件链接尽量放在页面头部。 CSS 加载不会阻塞 DOM tree 解析，但是会阻塞 DOM Tree 渲染，也会阻塞后面 JS 执行。\n任何 body 元素之前，可以确保在文档部分中解析了所有 CSS 样式（内联和外联），从而减少了浏览器必须重排文档的次数。\n如果放置页面底部，就要等待最后一个 CSS 文件下载完成，此时会出现\"白屏\"，影响用户体验。\nJS 引用放在 HTML 底部 防止 JS 在加载、解析、执行时，阻塞了页面后续元素的正常渲染。\n4、增强用户体验 设置 favicon.ico 网站如果不设置 favicon.ico，控制台会报错。另外页面加载过程中如果没有图标，则会出现 loading 过程，也不利于记忆网站品牌，建议统一添加。\n增加首屏必要的 CSS 和 JS 页面如果需要等待所的依赖的 JS 和 CSS 加载完成才显示，则在渲染过程中页面会一直显示空白，影响用户体验，建议在首屏增加必要的 CSS 和 JS，比如页面框架背景图片或者loading 图标，内联在 HTML 页面中。这样做，首屏能快速显示出来，缓解用户焦虑。现在很多网页在初始化的时候，流行做骨架屏，小伙伴们也可以研究下。\nCSS优化 1、提升 CSS 渲染性能 谨慎使用 expensive 属性，这类属性比较耗浏览器的性能。比如：nth-child 伪类；position: fixed 定位。\n尽量减少样式的层级数。\n比如：div ul li span i {color: blue;}这样的层级就太深了。建议给 i 标签设置 class属性，然后通过class直接设置样式属性，可以提升浏览器的查询效率。\n尽量避免使用占用过多 CPU 和内存的属性。比如：text-indnt:-99999px。\n尽量少使用耗电量大的属性。比如：CSS3 3D transforms、CSS3 transitions、Opacity 这样的属性会消耗GPU。\n2、合适使用 CSS 选择器 尽量避免使用 CSS 表达式。 比如 background-color: expression( (new Date()).getHours()%2 ? \"#FFF\" : \"#000\" );这个属性的意思是，每间隔两小时，改变白景色。\n尽量避免使用通配选择器。 比如 body \u003e a {font-weight:blod;}这样的属性，可能会把 body 里所有的标签遍历一遍，才找到 a 标签，比较耗时。\n尽量避免类正则的属性选择器：*=， |=， ^=， $= 3、提升 CSS 文件加载性能 使用外链的 CSS。 我们知道，内联的 css 是在html 内部写的。相比之下，外链的 CSS文件是放在CDN上的，可以缓存，既能减少 html 页面的体积大小，也能利用缓存减少资源的请求。\n尽量避免使用 @import 方法 整个CSS加载完成后，浏览器会把 import 中所有依赖的文件全部加载完成后，浏览器才会接着往下渲染。这个过程会阻塞CSS文件的加载过程。\n4、精简 CSS 代码 使用缩写语句 删除不必要的零。比如 0.2 可以写成 .2 删除不必要的单位，比如 0px 可以写成 0 删除过多的空格；注释言简意赅 尽量减少样式表的大小 5、合理使用 Web Fonts 将字体文件部署在 CDN 上。 或者将字体以 base64 形式保存在 CSS 中并通过 localStorage 进行缓存 Google 字体库因为某些不可抗拒原因，应该使用国内托管服务 6、CSS 动画优化 尽量避免同时出现过多动画。 延迟动画初始化：让其他的重要的CSS样式优先渲染。 结合 SVG。 JavaScript 总体优化 JavaScript 变量和函数优化 尽量使用 id 选择器 尽量避免使用 eval 使用事件节流函数 使用事件委托 JavaScript 动画优化 避免添加大量 JavaScript 动画\n尽量使用 CSS3 动画\n尽量使用 Canvas 动画\n合理使用 requestAnimationFrame 动画代替 setTimeout、setInterval\nrequestAnimationFrame可以在正确的时间进行渲染，setTimeout（callback）和setInterval（callback）无法保证 callback 回调函数的执行时机。\n合理使用缓存 合理缓存 DOM 对象\n缓存列表长度\n使用可缓存的 Ajax\nJavaScript 缓存优化 Cookie 通常由浏览器存储，然后将 Cookie 与每个后续请求一起发送到同一服务器。收到HTTP 请求时，服务器可以发送带有 Cookie 的 header 头。可以给 Cookie 设置有效时间。\n应用：\n会话管理：登录名，购物车商品，游戏得分或服务器应要记录的其他任何内容\n个性化：用户首选项，主题或其他设置\n跟踪：记录和分析用户行为，比如visitkey\nsessionStorage 创建一个本地存储的键/值对。\n应用：\n缓存。\n页面应用页面之间传值。\nLocalStorage 本地存储。\n应用于：\n缓存静态文件内容 JavaScript /CSS（比如百度M站首页） 缓存不常变更的 API 接口数据 储存地理位置信息 浏览在页面的具体位置 JavaScript 模块化加载方案和选型 CommonJS 旨在 Web 浏览器之外为 JavaScript 建立模块生态系统。Node.js 模块化方案受 CommonJS。\nAMD (Asynchronous Module Definition)（异步模块定义）规范。 RequireJS 模块化加载器：基于 AMD API 实现。\nCMD（ Common Module Definition）（通用模块定义）规范。 SeaJS 模块化加载器：遵循 CMD API 编写。\nES6 import。 减少回流和重绘重要举措 CSS 避免过多样式嵌套\n避免使用 CSS 表达式\n使用绝对定位，可以让动画元素脱离文档流\n避免使用 table 布局\n尽量不使用 float 布局\n图片最好设置好 width 和 height\n尽量简化浏览器不必要的任务，减少页面重新布局\n使用 Viewport 设置屏幕缩放级别\n避免频繁设置样式，最好把新 style 属性设置完成后，进行一次性更改\n避免使用引起回流/重绘的属性，最好把相应变量缓存起来\nJavaScript 最小化回流和重排：为了减少回流发生次数，避免频繁或操作 DOM，可以合并多次对 DOM 修改，然后一次性批量处理。\n控制绘制过程和绘制区域：绘制过程开销比较大的属性设置应该尽量避免减少使用；同时，减少绘制区域范围。\nDOM 编程优化的⽅式方法 控制 DOM 大小 众所周知，页面交互卡顿和流畅度很大一部分原因就是页面有大量 DOM 元素。想象一下，从一个上万节点的 DOM 树上，使用 querySelectorAll 或 getElementByTagName 方法查找某一个节点，是非常耗时的。另外元素绑定事件，事件冒泡和事件捕获的执行也会相对耗时。\n通常控制 DOM 大小的技巧包括：\n合理的业务逻辑\n延迟加载即将呈现的内容\n简化 DOM 操作 对DOM节点的操作统一处理后，再统一插入到 DOM Tree中。\n可以使用 fragment，尽量不在页面 DOM Tree 里直接操作。\n现在流行的框架 Angular、React、Vue 都在使用虚拟 DOM 技术，通过 diff 算法简化和减少 DOM 操作。\n静态文件压缩工具介绍 HTML 压缩工具：\nhtml-minifier：https://www.npmjs.com/package/html-minifier CSS 压缩工具：\nclean-css：https://www.npmjs.com/package/clean-css JavaScript 压缩工具：\nuglify-js：https://www.npmjs.com/package/uglify-js\n使用方法：uglifyjs in.js -o out.js\n静态⽂文件打包⽅方案 公共组件拆分\n压缩： JavaScript /CSS/图片\n合并： JavaScript /CSS 文件合并，CSS Sprite\nCombo： JavaScript /CSS 文件\n静态⽂文件版本号更新策略 缓存更新：CDN 或 ng 后台刷新文件路径，更新文件header头。\n文件 name.v1-v100.js：\n大功能迭代每次新增一个大版本，比如由 v1 到 v2\n小功能迭代新增加 0.0.1 或者 0.1.0，比如从 v1.0.0 至 v1.0.1\n年末 ng 统一配置所有版本 302 至最新版\n时间戳.文件 name.js：以每次上线时间点做差异。\nhash.文件。以文件内容 hash 值做 key。\n前端构建工具介绍和选型建议 常用构建工具 Gulp：通过流（Stream）来简化多个任务间的配置和输出，配置代码相对较少。\nWebpack：预编译，中间文件在内存中处理，支持多种模块化，配置相对很简单。\nFIS\nwebpack 打包优化 定位体积大的模块\n删除没有使用的依赖\n生产模式进行公共依赖包抽离\n开发模式进行 DLL \u0026 DllReference 方式优化\n","wordCount":"5560","inLanguage":"en","datePublished":"2020-03-01T17:11:35+08:00","dateModified":"2020-03-01T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=主页><span>主页</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=时间轴><span>时间轴</span></a></li><li><a href=https://bablvsj.github.io/tags title=标签><span>标签</span></a></li><li><a href=https://bablvsj.github.io/about title=关于><span>关于</span></a></li><li><a href=https://bablvsj.github.io/search title="🔍 (Alt + /)" accesskey=/><span>🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>静态资源优化</h1><div class=post-meta><ul class=post-tags-meta><a href=https://bablvsj.github.io/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/>前端性能优化</a></ul>12 min&nbsp;·&nbsp;<span title='2020-03-01 17:11:35 +0800 +0800'>2020/03/01</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e5%9b%be%e7%89%87%e6%a0%bc%e5%bc%8f%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af aria-label=图片格式和应用场景>图片格式和应用场景</a><ul><li><a href=#jpeg-%e6%a0%bc%e5%bc%8f aria-label="JPEG 格式">JPEG 格式</a></li><li><a href=#png-%e6%a0%bc%e5%bc%8f aria-label="PNG 格式">PNG 格式</a></li><li><a href=#gif-%e6%a0%bc%e5%bc%8f aria-label="GIF 格式">GIF 格式</a></li><li><a href=#webp-%e6%a0%bc%e5%bc%8f aria-label="Webp 格式">Webp 格式</a></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li></ul></li><li><a href=#%e5%9b%be%e7%89%87%e4%bc%98%e5%8c%96%e7%9a%84%e5%b8%b8%e8%a7%81%e6%96%b9%e6%b3%95 aria-label=图片优化的常见方法>图片优化的常见方法</a><ul><li><a href=#1%e7%94%a8%e5%b7%a5%e5%85%b7%e5%8e%8b%e7%bc%a9%e5%9b%be%e7%89%87 aria-label=1、用工具压缩图片>1、用工具压缩图片</a></li><li><a href=#2%e5%b0%86%e5%9b%be%e7%89%87%e5%b0%ba%e5%af%b8%e8%b7%9f%e9%9a%8f%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83%e8%bf%9b%e8%a1%8c%e5%8f%98%e5%8c%96 aria-label=2、将图片尺寸跟随网络环境进行变化>2、将图片尺寸跟随网络环境进行变化</a></li><li><a href=#3%e5%93%8d%e5%ba%94%e5%bc%8f%e5%9b%be%e7%89%87 aria-label=3、响应式图片>3、响应式图片</a></li><li><a href=#4%e9%80%90%e6%ad%a5%e5%8a%a0%e8%bd%bd%e5%9b%be%e5%83%8flazyloadlqiplqip aria-label=4、逐步加载图像：lazyload、LQIP、LQIP>4、逐步加载图像：lazyload、LQIP、LQIP</a></li><li><a href=#5%e9%9b%aa%e7%a2%a7%e5%9b%beimage-spriting aria-label="5、雪碧图（Image spriting）">5、雪碧图（Image spriting）</a></li><li><a href=#6%e6%9c%89%e4%ba%9b%e5%9c%ba%e6%99%af%e4%b8%8b%e5%b9%b6%e4%b8%8d%e9%9c%80%e8%a6%81%e5%9b%be%e7%89%87%e6%96%87%e4%bb%b6 aria-label=6、有些场景下，并不需要图片文件>6、有些场景下，并不需要图片文件</a></li><li><a href=#7%e5%9c%a8%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e8%bf%9b%e8%a1%8c%e5%9b%be%e7%89%87%e8%87%aa%e5%8a%a8%e4%bc%98%e5%8c%96 aria-label=7、在服务器端进行图片自动优化>7、在服务器端进行图片自动优化</a></li></ul></li><li><a href=#html%e4%bc%98%e5%8c%96 aria-label=HTML优化>HTML优化</a><ul><li><a href=#1%e7%b2%be%e7%ae%80-html-%e4%bb%a3%e7%a0%81 aria-label="1、精简 HTML 代码">1、精简 HTML 代码</a></li><li><a href=#2%e6%96%87%e4%bb%b6%e6%94%be%e5%9c%a8%e5%90%88%e9%80%82%e4%bd%8d%e7%bd%ae aria-label=2、文件放在合适位置>2、文件放在合适位置</a></li><li><a href=#4%e5%a2%9e%e5%bc%ba%e7%94%a8%e6%88%b7%e4%bd%93%e9%aa%8c aria-label=4、增强用户体验>4、增强用户体验</a></li></ul></li><li><a href=#css%e4%bc%98%e5%8c%96 aria-label=CSS优化>CSS优化</a><ul><li><a href=#1%e6%8f%90%e5%8d%87-css-%e6%b8%b2%e6%9f%93%e6%80%a7%e8%83%bd aria-label="1、提升 CSS 渲染性能">1、提升 CSS 渲染性能</a></li><li><a href=#2%e5%90%88%e9%80%82%e4%bd%bf%e7%94%a8-css-%e9%80%89%e6%8b%a9%e5%99%a8 aria-label="2、合适使用 CSS 选择器">2、合适使用 CSS 选择器</a></li><li><a href=#3%e6%8f%90%e5%8d%87-css-%e6%96%87%e4%bb%b6%e5%8a%a0%e8%bd%bd%e6%80%a7%e8%83%bd aria-label="3、提升 CSS 文件加载性能">3、提升 CSS 文件加载性能</a></li><li><a href=#4%e7%b2%be%e7%ae%80-css-%e4%bb%a3%e7%a0%81 aria-label="4、精简 CSS 代码">4、精简 CSS 代码</a></li><li><a href=#5%e5%90%88%e7%90%86%e4%bd%bf%e7%94%a8-web-fonts aria-label="5、合理使用 Web Fonts">5、合理使用 Web Fonts</a></li><li><a href=#6css-%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96 aria-label="6、CSS 动画优化">6、CSS 动画优化</a></li></ul></li><li><a href=#javascript-%e6%80%bb%e4%bd%93%e4%bc%98%e5%8c%96 aria-label="JavaScript 总体优化">JavaScript 总体优化</a><ul><li><a href=#javascript-%e5%8f%98%e9%87%8f%e5%92%8c%e5%87%bd%e6%95%b0%e4%bc%98%e5%8c%96 aria-label="JavaScript 变量和函数优化">JavaScript 变量和函数优化</a></li><li><a href=#javascript-%e5%8a%a8%e7%94%bb%e4%bc%98%e5%8c%96 aria-label="JavaScript 动画优化">JavaScript 动画优化</a></li><li><a href=#%e5%90%88%e7%90%86%e4%bd%bf%e7%94%a8%e7%bc%93%e5%ad%98 aria-label=合理使用缓存>合理使用缓存</a></li></ul></li><li><a href=#javascript-%e7%bc%93%e5%ad%98%e4%bc%98%e5%8c%96 aria-label="JavaScript 缓存优化">JavaScript 缓存优化</a><ul><li><a href=#cookie aria-label=Cookie>Cookie</a></li><li><a href=#sessionstorage aria-label=sessionStorage>sessionStorage</a></li><li><a href=#localstorage aria-label=LocalStorage>LocalStorage</a></li></ul></li><li><a href=#javascript-%e6%a8%a1%e5%9d%97%e5%8c%96%e5%8a%a0%e8%bd%bd%e6%96%b9%e6%a1%88%e5%92%8c%e9%80%89%e5%9e%8b aria-label="JavaScript 模块化加载方案和选型">JavaScript 模块化加载方案和选型</a></li><li><a href=#%e5%87%8f%e5%b0%91%e5%9b%9e%e6%b5%81%e5%92%8c%e9%87%8d%e7%bb%98%e9%87%8d%e8%a6%81%e4%b8%be%e6%8e%aa aria-label=减少回流和重绘重要举措>减少回流和重绘重要举措</a><ul><li><a href=#css aria-label=CSS>CSS</a></li><li><a href=#javascript aria-label=JavaScript>JavaScript</a></li></ul></li><li><a href=#dom-%e7%bc%96%e7%a8%8b%e4%bc%98%e5%8c%96%e7%9a%84%e5%bc%8f%e6%96%b9%e6%b3%95 aria-label="DOM 编程优化的⽅式方法">DOM 编程优化的⽅式方法</a><ul><li><a href=#%e6%8e%a7%e5%88%b6-dom-%e5%a4%a7%e5%b0%8f aria-label="控制 DOM 大小">控制 DOM 大小</a></li><li><a href=#%e7%ae%80%e5%8c%96-dom-%e6%93%8d%e4%bd%9c aria-label="简化 DOM 操作">简化 DOM 操作</a></li></ul></li><li><a href=#%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6%e5%8e%8b%e7%bc%a9%e5%b7%a5%e5%85%b7%e4%bb%8b%e7%bb%8d aria-label=静态文件压缩工具介绍>静态文件压缩工具介绍</a></li><li><a href=#%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6%e6%89%93%e5%8c%85%e6%96%b9%e6%a1%88 aria-label=静态⽂文件打包⽅方案>静态⽂文件打包⽅方案</a></li><li><a href=#%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6%e7%89%88%e6%9c%ac%e5%8f%b7%e6%9b%b4%e6%96%b0%e7%ad%96%e7%95%a5 aria-label=静态⽂文件版本号更新策略>静态⽂文件版本号更新策略</a></li><li><a href=#%e5%89%8d%e7%ab%af%e6%9e%84%e5%bb%ba%e5%b7%a5%e5%85%b7%e4%bb%8b%e7%bb%8d%e5%92%8c%e9%80%89%e5%9e%8b%e5%bb%ba%e8%ae%ae aria-label=前端构建工具介绍和选型建议>前端构建工具介绍和选型建议</a><ul><li><a href=#%e5%b8%b8%e7%94%a8%e6%9e%84%e5%bb%ba%e5%b7%a5%e5%85%b7 aria-label=常用构建工具>常用构建工具</a></li><li><a href=#webpack-%e6%89%93%e5%8c%85%e4%bc%98%e5%8c%96 aria-label="webpack 打包优化">webpack 打包优化</a></li></ul></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=图片格式和应用场景>图片格式和应用场景<a hidden class=anchor aria-hidden=true href=#图片格式和应用场景>#</a></h2><h3 id=jpeg-格式>JPEG 格式<a hidden class=anchor aria-hidden=true href=#jpeg-格式>#</a></h3><p>JPEG（Joint Photographic Experts Group）是一种针对彩色照片而广泛使用的有损压缩图形格式，属于位图。</p><p>常用文件扩展名为<code>.jpg</code>，也有 <code>.jpeg</code>和<code>.jpe</code>。JPEG 在互联网上常被应用于存储和传输照片。</p><ul><li><p>适合：颜色丰富的照片、彩色图大焦点图、通栏 banner 图；结构不规则的图形。</p></li><li><p>不适合：线条图形和文字、图标图形，因为它的压缩算法不太这些类型的图形；并且不支持透明度。</p></li></ul><h3 id=png-格式>PNG 格式<a hidden class=anchor aria-hidden=true href=#png-格式>#</a></h3><p>PNG（Portable Network Graphics）是一种无损压缩的位图图形格式，支持索引、灰度、RGB 三种颜色方案以及 Alpha 通道等特性。</p><p>PNG 最初是作为替代 GIF 来设计的，能够显示 256 色，文件比 JPEG 或者 GIF 大，但是 PNG 非常好的保留了图像质量。支持 Alpha 通道的半透明和透明特性。最高支持 24 位彩色图像（PNG-24）和 8 位灰度图像（PNG-8）。</p><ul><li><p>适合：纯色、<strong>透明</strong>、线条绘图，图标；边缘清晰、有大块相同颜色区域；需要带<strong>半透明</strong>的图片。</p></li><li><p>适合：由于是无损存储，所以不太适合体积太大的彩色图像</p></li></ul><p>比如说，如果你需要带透明背景的图片，此时就可以用 png 格式的图。</p><h3 id=gif-格式>GIF 格式<a hidden class=anchor aria-hidden=true href=#gif-格式>#</a></h3><p>GIF（Graphics Interchange Format）是一种位图图形格式，以 8 位色（即 256 种颜色）重现真彩色的图像，采用 LZW 压缩算法进行编码。</p><p>支持 256 色；仅支持完全透明和完全不透明；如果需要带动画效果的图片，GIF 是比较通用的选择。</p><ul><li><p>适合：动画，图标。</p></li><li><p>不适合：每个像素只有 8 比特，不适合存储彩色图片。</p></li></ul><h3 id=webp-格式>Webp 格式<a hidden class=anchor aria-hidden=true href=#webp-格式>#</a></h3><p>Webp 是一种现代图像格式，可为图像提供无损压缩和有损压缩，这使得它非常灵活。由 Google 在购买 On2 Technologies 后发展出来，以 BSD 授权条款发布。</p><p>Webp的优秀算法能同时保证图像质量和较小体积；可以插入多帧，实现动画效果；可以设置透明度；采用 8 位压缩算法。</p><p>无损的 Webp 比 PNG 小 26%，有损的 Webp 比 JPEG 小 25-34％，比 GIF 有更好的动画。</p><ul><li>适合：适用于图形和半透明图像。</li></ul><h3 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h3><ul><li><p>banner图、大图，可以用 jpg、webp格式。</p></li><li><p>图标、带透明背景的图，可以用 png 格式。</p></li><li><p>带动画效果的图，可以用 gif 格式。</p></li></ul><h2 id=图片优化的常见方法>图片优化的常见方法<a hidden class=anchor aria-hidden=true href=#图片优化的常见方法>#</a></h2><h3 id=1用工具压缩图片>1、用工具压缩图片<a hidden class=anchor aria-hidden=true href=#1用工具压缩图片>#</a></h3><p><strong>压缩 PNG 图片</strong>：</p><ul><li><p>工具：<a href=https://www.npmjs.com/package/node-pngquant-native>node-pngquant-native</a></p></li><li><p>介绍：跨平台、压缩比特别高，压缩png24非常好。</p></li></ul><p>安装方法：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>npm install node-pngquant-native
</span></span></code></pre></td></tr></table></div></div><p><strong>压缩 JPEG 图片</strong>：</p><ul><li><p>工具：<a href=https://www.npmjs.com/package/jpegtran>jpegtran</a></p></li><li><p>官网：<a href=https://www.npmjs.com/package/jpegtran>https://www.npmjs.com/package/jpegtran</a></p></li><li><p>介绍：跨平台，但压缩的比率只有80-90%。</p></li></ul><p>安装方法：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install –g jpegtran
</span></span></code></pre></td></tr></table></div></div><p>使用方法：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>jpegtran -copy none -optimize -outfile output_file.jpg input_file.jpg
</span></span></code></pre></td></tr></table></div></div><p><strong>压缩 GIF 图</strong>：</p><ul><li><p>工具：Gifsicle</p></li><li><p>官网（含安装方法）：<a href=https://www.lcdf.org/gifsicle/>https://www.lcdf.org/gifsicle/</a></p></li><li><p>介绍：Gifsicle 通过改变每帧比例，减小 gif文件大小，同时可以使用透明来达到更小的文件大小，是目前公认的最好的解决方案。</p></li></ul><p>使用方法：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#007f7f># 压缩命令。注意，这里是将压缩级别设置为3。如果将压缩级别设置为1或者2，则基本不压缩。</span>
</span></span><span style=display:flex><span>gifsicle --optimize=<span style=color:#ff0;font-weight:700>3</span> -o out_file.gif in_file.gif
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 裁掉透明部分</span>
</span></span><span style=display:flex><span>gifsicle --optimize=<span style=color:#ff0;font-weight:700>3</span> --crop-transparency -o out_file.gif in_file.gif
</span></span></code></pre></td></tr></table></div></div><h3 id=2将图片尺寸跟随网络环境进行变化>2、将图片尺寸跟随网络环境进行变化<a hidden class=anchor aria-hidden=true href=#2将图片尺寸跟随网络环境进行变化>#</a></h3><p><strong>具体方案</strong>：不同网络环境（Wifi/4G/3G）下，加载不同尺寸和像素的图片，通过在图片 URL 中添加参数来改变。</p><p>图片 url 举例1：（图片的原始url链接）</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg
</span></span></code></pre></td></tr></table></div></div><p>图片 url 举例2：（通过图片的url参数，将这张图的尺寸设置为200px）</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg
</span></span></code></pre></td></tr></table></div></div><h3 id=3响应式图片>3、响应式图片<a hidden class=anchor aria-hidden=true href=#3响应式图片>#</a></h3><p><strong>方法1</strong>：通过 JavaScript 绑定事件，检测窗口大小，以此设置图片大小。</p><p><strong>方法2</strong>：CSS媒体查询。</p><p>代码举例：（在 640px的窗口大小里，设置图片的尺寸为640px）</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span>@<span style=color:#fff;font-weight:700>media</span> <span style=font-weight:700>screen</span> <span style=font-weight:700>and</span> (<span style=font-weight:700>max-width</span>:640px) {
</span></span><span style=display:flex><span>  <span style=font-weight:700>my_image</span>{
</span></span><span style=display:flex><span>    <span style=color:#fff;font-weight:700>width</span>:<span style=color:#ff0;font-weight:700>640</span><span style=color:#fff;font-weight:700>px</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span></code></pre></td></tr></table></div></div><p><strong>方法3</strong>：img标签的 <code>srcset</code> 属性。这个是 H5的新特性。</p><p>代码举例：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=font-weight:700>img</span> <span style=color:#007f7f>srcset</span>=<span style=color:#0ff;font-weight:700>&#34;img-320w.jpg, img-640w.jpg 2x, img-960w.jpg 3x&#34;</span> <span style=color:#007f7f>src</span>=<span style=color:#0ff;font-weight:700>“img-960w.jpg”</span>
</span></span><span style=display:flex><span><span style=color:#007f7f>alt</span>=<span style=color:#0ff;font-weight:700>“img”</span>&gt; （x 描述符：表示图像的设备像素）
</span></span></code></pre></td></tr></table></div></div><h3 id=4逐步加载图像lazyloadlqiplqip>4、逐步加载图像：lazyload、LQIP、LQIP<a hidden class=anchor aria-hidden=true href=#4逐步加载图像lazyloadlqiplqip>#</a></h3><p><strong>方法1</strong>、使用统一占位符。俗称图片的<code>懒加载（lazyload）</code>。</p><p><strong>方法2</strong>、使用 <strong>LQIP</strong> 的图片加载方式。也就是说，在大图没有完全加载出来的情况下，先这张图对应的的低质量图片进行占位。</p><p>LQIP（Low Quality Image Placeholders）：低质量图像占位符。这种技术背后的想法是，在网络环境较差的情况下，你可以尽快向用户展示完全可用的网页，为他们提供更好的体验。即使在更好的网络连接上，这仍然为用户提供了更快的可用页面，并且改善了体验。</p><ul><li><p>安装 LQIP 工具：<code>npm install lqip</code></p></li><li><p>GitHub源码：https://github.com/zouhir/lqip-loader</p></li></ul><p>代码举例：（将目标图片转换为 LQIP 形式的图）</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#fff;font-weight:700>const</span> lqip = require(<span style=color:#0ff;font-weight:700>&#39;lqip&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>//文件路径
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>const</span> file = <span style=color:#0ff;font-weight:700>&#39;./in.png&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>//将输入的图片转为base64
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>lqip.base64(file).then(res =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#007f7f>// 色值
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>    console.log(res);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lqip.palette(file).then(res =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#007f7f>//这里输出的是base64的图片地址
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>    console.log(res);
</span></span><span style=display:flex><span>});
</span></span></code></pre></td></tr></table></div></div><p>另外，我们还可以使用 <strong>SQIP</strong> 的图片加载方式。</p><p>SQIP（SVG Quality Image Placeholders）： SVG 格式的图像占位符。</p><ul><li><p>安装 SQIP 工具：<code>npm install sqip</code></p></li><li><p>GitHub 源码：<a href=https://github.com/axe312ger/sqip>https://github.com/axe312ger/sqip</a></p></li></ul><p>代码举例：（将目标图片转换为 SQIP 形式的图）</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#fff;font-weight:700>const</span> sqip = require(<span style=color:#0ff;font-weight:700>&#39;sqip&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>const</span> result =  sqip({
</span></span><span style=display:flex><span>    filename: <span style=color:#0ff;font-weight:700>&#39;./input_file.png&#39;</span>,
</span></span><span style=display:flex><span>    numberOfPrimitives: <span style=color:#ff0;font-weight:700>10</span> <span style=color:#007f7f>//可根据不同应用场景设置大小
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(result.final_svg);
</span></span></code></pre></td></tr></table></div></div><h3 id=5雪碧图image-spriting>5、雪碧图（Image spriting）<a hidden class=anchor aria-hidden=true href=#5雪碧图image-spriting>#</a></h3><p>雪碧图是比较常见的图片优化方式，也就是把多张小图合并成一张大图。这样的话，就只需做一次网络请求，减少图片的 http 请求次数。</p><p>读者们可以自行查阅。</p><h3 id=6有些场景下并不需要图片文件>6、有些场景下，并不需要图片文件<a hidden class=anchor aria-hidden=true href=#6有些场景下并不需要图片文件>#</a></h3><p>有些场景下，并不需要图片，我们可以用其他的方式来代替图片。</p><p>举例：</p><ul><li><p>Web Font 代替图片</p></li><li><p>使用 Data URI 代替图片。base64就是属于 Data URI的方式。</p></li></ul><h3 id=7在服务器端进行图片自动优化>7、在服务器端进行图片自动优化<a hidden class=anchor aria-hidden=true href=#7在服务器端进行图片自动优化>#</a></h3><p>图片服务器自动化优化是可以在图片 URL 链接上增加不同特殊参数，服务器自动化生成。通过这些参数，可以设置图片的不同格式、大小、质量。</p><p><strong>常见处理方式</strong>：</p><ul><li><p>图片裁剪：按长边、短边、填充、拉伸等缩放。</p></li><li><p>图片格式转换：支持 JPG，GIF，PNG，WebP 等，支持不同的图片压缩率。</p></li><li><p>图片处理：添加图片水印、高斯模糊、重心处理、裁剪边框等。</p></li><li><p>AI 能力：鉴黄、涉政、智能抠图、智能排版、智能配色、智能合成等 AI 功能。</p></li></ul><p><strong>图片举例</strong>：</p><p>比如JD公司的图片链接，就会在服务器端做优化处理。通过修改图片链接中的参数，就能自动达到相应的优化效果。</p><p>原始图片链接：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg
</span></span></code></pre></td></tr></table></div></div><p>将图片压缩为 200*150：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg
</span></span></code></pre></td></tr></table></div></div><p>将图片转换为 webp 格式：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s200x200_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.webp
</span></span></code></pre></td></tr></table></div></div><p>将图片质量压缩至10%：</p><div class=highlight><div style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#727272">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>https://img12.360buyimg.com/img/s3866x3866_jfs/t1/149913/14/18648/719436/5fd8b9b5Eb697b825/7c23f3028aff8e2b.jpg.q10
</span></span></code></pre></td></tr></table></div></div><h2 id=html优化>HTML优化<a hidden class=anchor aria-hidden=true href=#html优化>#</a></h2><h3 id=1精简-html-代码>1、精简 HTML 代码<a hidden class=anchor aria-hidden=true href=#1精简-html-代码>#</a></h3><ul><li><p>减少 HTML 的嵌套。</p></li><li><p>减少 DOM 节点数。</p></li><li><p>减少无语义代码（比如:<div class=“clear”></div>消除浮动，其实可以用css来处理）。</p></li><li><p>删除 http 或者 https：如果URL的协议头和当前页面的协议头一致的，或者此 URL 在多个协议头都是可用的，则可以考虑删除协议头。</p></li><li><p>删除多余的空格、换行符、缩进和不必要的注释。</p></li><li><p>省略冗余标签和属性。</p></li><li><p>使用相对路径的 URL。</p></li></ul><h3 id=2文件放在合适位置>2、文件放在合适位置<a hidden class=anchor aria-hidden=true href=#2文件放在合适位置>#</a></h3><ul><li>CSS 样式文件链接尽量放在页面头部。</li></ul><p>CSS 加载不会阻塞 DOM tree 解析，但是会阻塞 DOM Tree 渲染，也会阻塞后面 JS 执行。</p><p>任何 body 元素之前，可以确保在文档部分中解析了所有 CSS 样式（内联和外联），从而减少了浏览器必须重排文档的次数。</p><p>如果放置页面底部，就要等待最后一个 CSS 文件下载完成，此时会出现"白屏"，影响用户体验。</p><ul><li>JS 引用放在 HTML 底部</li></ul><p>防止 JS 在加载、解析、执行时，阻塞了页面后续元素的正常渲染。</p><h3 id=4增强用户体验>4、增强用户体验<a hidden class=anchor aria-hidden=true href=#4增强用户体验>#</a></h3><ul><li>设置 favicon.ico</li></ul><p>网站如果不设置 favicon.ico，控制台会报错。另外页面加载过程中如果没有图标，则会出现 loading 过程，也不利于记忆网站品牌，建议统一添加。</p><ul><li>增加首屏必要的 CSS 和 JS</li></ul><p>页面如果需要等待所的依赖的 JS 和 CSS 加载完成才显示，则在渲染过程中页面会一直显示空白，影响用户体验，建议在首屏增加必要的 CSS 和 JS，比如页面框架背景图片或者loading 图标，内联在 HTML 页面中。这样做，首屏能快速显示出来，缓解用户焦虑。现在很多网页在初始化的时候，流行做<strong>骨架屏</strong>，小伙伴们也可以研究下。</p><h2 id=css优化>CSS优化<a hidden class=anchor aria-hidden=true href=#css优化>#</a></h2><h3 id=1提升-css-渲染性能>1、提升 CSS 渲染性能<a hidden class=anchor aria-hidden=true href=#1提升-css-渲染性能>#</a></h3><ul><li><p>谨慎使用 expensive 属性，这类属性比较耗浏览器的性能。比如：<code>nth-child</code> 伪类；<code>position: fixed</code> 定位。</p></li><li><p>尽量减少样式的层级数。</p></li></ul><p>比如：<code>div ul li span i {color: blue;}</code>这样的层级就太深了。建议给 i 标签设置 class属性，然后通过class直接设置样式属性，可以提升浏览器的查询效率。</p><ul><li><p>尽量避免使用占用过多 CPU 和内存的属性。比如：<code>text-indnt:-99999px</code>。</p></li><li><p>尽量少使用耗电量大的属性。比如：CSS3 3D transforms、CSS3 transitions、Opacity 这样的属性会消耗GPU。</p></li></ul><h3 id=2合适使用-css-选择器>2、合适使用 CSS 选择器<a hidden class=anchor aria-hidden=true href=#2合适使用-css-选择器>#</a></h3><ul><li>尽量避免使用 CSS 表达式。</li></ul><p>比如 <code>background-color: expression( (new Date()).getHours()%2 ? "#FFF" : "#000" );</code>这个属性的意思是，每间隔两小时，改变白景色。</p><ul><li>尽量避免使用通配选择器。</li></ul><p>比如 <code>body > a {font-weight:blod;}</code>这样的属性，可能会把 body 里所有的标签遍历一遍，才找到 a 标签，比较耗时。</p><ul><li>尽量避免类正则的属性选择器：<code>*=， |=， ^=， $=</code></li></ul><h3 id=3提升-css-文件加载性能>3、提升 CSS 文件加载性能<a hidden class=anchor aria-hidden=true href=#3提升-css-文件加载性能>#</a></h3><ul><li>使用外链的 CSS。</li></ul><p>我们知道，内联的 css 是在html 内部写的。相比之下，外链的 CSS文件是放在CDN上的，可以缓存，既能减少 html 页面的体积大小，也能利用缓存减少资源的请求。</p><ul><li>尽量避免使用 @import 方法</li></ul><p>整个CSS加载完成后，浏览器会把 import 中所有依赖的文件全部加载完成后，浏览器才会接着往下渲染。这个过程会阻塞CSS文件的加载过程。</p><h3 id=4精简-css-代码>4、精简 CSS 代码<a hidden class=anchor aria-hidden=true href=#4精简-css-代码>#</a></h3><ul><li>使用缩写语句</li><li>删除不必要的零。比如 0.2 可以写成 .2</li><li>删除不必要的单位，比如 0px 可以写成 0</li><li>删除过多的空格；注释言简意赅</li><li>尽量减少样式表的大小</li></ul><h3 id=5合理使用-web-fonts>5、合理使用 Web Fonts<a hidden class=anchor aria-hidden=true href=#5合理使用-web-fonts>#</a></h3><ul><li>将字体文件部署在 CDN 上。</li><li>或者将字体以 base64 形式保存在 CSS 中并通过 localStorage 进行缓存</li><li>Google 字体库因为某些不可抗拒原因，应该使用国内托管服务</li></ul><h3 id=6css-动画优化>6、CSS 动画优化<a hidden class=anchor aria-hidden=true href=#6css-动画优化>#</a></h3><ul><li>尽量避免同时出现过多动画。</li><li>延迟动画初始化：让其他的重要的CSS样式优先渲染。</li><li>结合 SVG。</li></ul><h2 id=javascript-总体优化>JavaScript 总体优化<a hidden class=anchor aria-hidden=true href=#javascript-总体优化>#</a></h2><h3 id=javascript-变量和函数优化>JavaScript 变量和函数优化<a hidden class=anchor aria-hidden=true href=#javascript-变量和函数优化>#</a></h3><ul><li>尽量使用 id 选择器</li><li>尽量避免使用 eval</li><li>使用事件节流函数</li><li>使用事件委托</li></ul><h3 id=javascript-动画优化>JavaScript 动画优化<a hidden class=anchor aria-hidden=true href=#javascript-动画优化>#</a></h3><ul><li><p>避免添加大量 JavaScript 动画</p></li><li><p>尽量使用 CSS3 动画</p></li><li><p>尽量使用 Canvas 动画</p></li><li><p>合理使用 requestAnimationFrame 动画代替 setTimeout、setInterval</p></li><li><p>requestAnimationFrame可以在正确的时间进行渲染，setTimeout（callback）和setInterval（callback）无法保证 callback 回调函数的执行时机。</p></li></ul><h3 id=合理使用缓存>合理使用缓存<a hidden class=anchor aria-hidden=true href=#合理使用缓存>#</a></h3><ul><li><p>合理缓存 DOM 对象</p></li><li><p>缓存列表长度</p></li><li><p>使用可缓存的 Ajax</p></li></ul><h2 id=javascript-缓存优化>JavaScript 缓存优化<a hidden class=anchor aria-hidden=true href=#javascript-缓存优化>#</a></h2><h3 id=cookie>Cookie<a hidden class=anchor aria-hidden=true href=#cookie>#</a></h3><p>通常由浏览器存储，然后将 Cookie 与每个后续请求一起发送到同一服务器。收到HTTP 请求时，服务器可以发送带有 Cookie 的 header 头。可以给 Cookie 设置有效时间。</p><p>应用：</p><ul><li><p>会话管理：登录名，购物车商品，游戏得分或服务器应要记录的其他任何内容</p></li><li><p>个性化：用户首选项，主题或其他设置</p></li><li><p>跟踪：记录和分析用户行为，比如visitkey</p></li></ul><h3 id=sessionstorage>sessionStorage<a hidden class=anchor aria-hidden=true href=#sessionstorage>#</a></h3><p>创建一个本地存储的键/值对。</p><p>应用：</p><ul><li><p>缓存。</p></li><li><p>页面应用页面之间传值。</p></li></ul><h3 id=localstorage>LocalStorage<a hidden class=anchor aria-hidden=true href=#localstorage>#</a></h3><p>本地存储。</p><p>应用于：</p><ul><li>缓存静态文件内容 JavaScript /CSS（比如百度M站首页）</li><li>缓存不常变更的 API 接口数据</li><li>储存地理位置信息</li><li>浏览在页面的具体位置</li></ul><h2 id=javascript-模块化加载方案和选型>JavaScript 模块化加载方案和选型<a hidden class=anchor aria-hidden=true href=#javascript-模块化加载方案和选型>#</a></h2><ul><li>CommonJS</li></ul><p>旨在 Web 浏览器之外为 JavaScript 建立模块生态系统。Node.js 模块化方案受 CommonJS。</p><ul><li>AMD (Asynchronous Module Definition)（异步模块定义）规范。</li></ul><p>RequireJS 模块化加载器：基于 AMD API 实现。</p><ul><li>CMD（ Common Module Definition）（通用模块定义）规范。</li></ul><p>SeaJS 模块化加载器：遵循 CMD API 编写。</p><ul><li>ES6 import。</li></ul><h2 id=减少回流和重绘重要举措>减少回流和重绘重要举措<a hidden class=anchor aria-hidden=true href=#减少回流和重绘重要举措>#</a></h2><h3 id=css>CSS<a hidden class=anchor aria-hidden=true href=#css>#</a></h3><ul><li><p>避免过多样式嵌套</p></li><li><p>避免使用 CSS 表达式</p></li><li><p>使用绝对定位，可以让动画元素脱离文档流</p></li><li><p>避免使用 table 布局</p></li><li><p>尽量不使用 float 布局</p></li><li><p>图片最好设置好 width 和 height</p></li><li><p>尽量简化浏览器不必要的任务，减少页面重新布局</p></li><li><p>使用 Viewport 设置屏幕缩放级别</p></li><li><p>避免频繁设置样式，最好把新 style 属性设置完成后，进行一次性更改</p></li><li><p>避免使用引起回流/重绘的属性，最好把相应变量缓存起来</p></li></ul><h3 id=javascript>JavaScript<a hidden class=anchor aria-hidden=true href=#javascript>#</a></h3><ul><li><p>最小化回流和重排：为了减少回流发生次数，避免频繁或操作 DOM，可以合并多次对 DOM 修改，然后一次性批量处理。</p></li><li><p>控制绘制过程和绘制区域：绘制过程开销比较大的属性设置应该尽量避免减少使用；同时，减少绘制区域范围。</p></li></ul><h2 id=dom-编程优化的式方法>DOM 编程优化的⽅式方法<a hidden class=anchor aria-hidden=true href=#dom-编程优化的式方法>#</a></h2><h3 id=控制-dom-大小>控制 DOM 大小<a hidden class=anchor aria-hidden=true href=#控制-dom-大小>#</a></h3><p>众所周知，页面交互卡顿和流畅度很大一部分原因就是页面有大量 DOM 元素。想象一下，从一个上万节点的 DOM 树上，使用 querySelectorAll 或 getElementByTagName 方法查找某一个节点，是非常耗时的。另外元素绑定事件，事件冒泡和事件捕获的执行也会相对耗时。</p><p>通常控制 DOM 大小的技巧包括：</p><ul><li><p>合理的业务逻辑</p></li><li><p>延迟加载即将呈现的内容</p></li></ul><h3 id=简化-dom-操作>简化 DOM 操作<a hidden class=anchor aria-hidden=true href=#简化-dom-操作>#</a></h3><p>对DOM节点的操作统一处理后，再统一插入到 DOM Tree中。</p><p>可以使用 fragment，尽量不在页面 DOM Tree 里直接操作。</p><p>现在流行的框架 Angular、React、Vue 都在使用虚拟 DOM 技术，通过 diff 算法简化和减少 DOM 操作。</p><h2 id=静态文件压缩工具介绍>静态文件压缩工具介绍<a hidden class=anchor aria-hidden=true href=#静态文件压缩工具介绍>#</a></h2><p>HTML 压缩工具：</p><ul><li>html-minifier：https://www.npmjs.com/package/html-minifier</li></ul><p>CSS 压缩工具：</p><ul><li>clean-css：https://www.npmjs.com/package/clean-css</li></ul><p>JavaScript 压缩工具：</p><ul><li><p>uglify-js：https://www.npmjs.com/package/uglify-js</p></li><li><p>使用方法：uglifyjs in.js -o out.js</p></li></ul><h2 id=静态文件打包方案>静态⽂文件打包⽅方案<a hidden class=anchor aria-hidden=true href=#静态文件打包方案>#</a></h2><ul><li><p>公共组件拆分</p></li><li><p>压缩： JavaScript /CSS/图片</p></li><li><p>合并： JavaScript /CSS 文件合并，CSS Sprite</p></li><li><p>Combo： JavaScript /CSS 文件</p></li></ul><h2 id=静态文件版本号更新策略>静态⽂文件版本号更新策略<a hidden class=anchor aria-hidden=true href=#静态文件版本号更新策略>#</a></h2><p>缓存更新：CDN 或 ng 后台刷新文件路径，更新文件header头。</p><p>文件 name.v1-v100.js：</p><ul><li><p>大功能迭代每次新增一个大版本，比如由 v1 到 v2</p></li><li><p>小功能迭代新增加 0.0.1 或者 0.1.0，比如从 v1.0.0 至 v1.0.1</p></li><li><p>年末 ng 统一配置所有版本 302 至最新版</p></li></ul><p>时间戳.文件 name.js：以每次上线时间点做差异。</p><p>hash.文件。以文件内容 hash 值做 key。</p><h2 id=前端构建工具介绍和选型建议>前端构建工具介绍和选型建议<a hidden class=anchor aria-hidden=true href=#前端构建工具介绍和选型建议>#</a></h2><h3 id=常用构建工具>常用构建工具<a hidden class=anchor aria-hidden=true href=#常用构建工具>#</a></h3><ul><li><p>Gulp：通过流（Stream）来简化多个任务间的配置和输出，配置代码相对较少。</p></li><li><p>Webpack：预编译，中间文件在内存中处理，支持多种模块化，配置相对很简单。</p></li><li><p>FIS</p></li></ul><h3 id=webpack-打包优化>webpack 打包优化<a hidden class=anchor aria-hidden=true href=#webpack-打包优化>#</a></h3><ul><li><p>定位体积大的模块</p></li><li><p>删除没有使用的依赖</p></li><li><p>生产模式进行公共依赖包抽离</p></li><li><p>开发模式进行 DLL & DllReference 方式优化</p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/>前端性能优化</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/03-%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96/><span class=title>« Prev</span><br><span>渲染优化</span></a>
<a class=next href=https://bablvsj.github.io/posts/tech/wait/zzz-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/><span class=title>Next »</span><br><span>页面渲染性能优化</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>本站由</span><img width=60 src=/images/upyun.png>提供CDN加速/云存储服务</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>